<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>用 awk 处理 NGS 数据 - My Docs</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">My Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Welcome to MkDocs</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapter 01 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../01_basic-cml/">基本命令</a>
</li>
                            
<li >
    <a href="../02_linux-installation/">02 linux installation</a>
</li>
                            
<li >
    <a href="../03_linux-administration/">03 linux administration</a>
</li>
                            
<li class="active">
    <a href="./">用 awk 处理 NGS 数据</a>
</li>
                            
<li >
    <a href="../05_bioawk/">05 bioawk</a>
</li>
                            
<li >
    <a href="../06_python/">06 python</a>
</li>
                            
<li >
    <a href="../07_shell/">07 shell</a>
</li>
                            
<li >
    <a href="../">Home</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapter 02 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../chapter_02/01_emboss/">01 emboss</a>
</li>
                            
<li >
    <a href="../../chapter_02/02_blast/">02 blast</a>
</li>
                            
<li >
    <a href="../../chapter_02/08_seqkit/">08 seqkit</a>
</li>
                            
<li >
    <a href="../../chapter_02/09_khmer/">09 khmer</a>
</li>
                            
<li >
    <a href="../../chapter_02/">Home</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapter 04 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../chapter_04/03_bacteria-assembly/">03 bacteria assembly</a>
</li>
                            
<li >
    <a href="../../chapter_04/04_virus-assembly/">04 virus assembly</a>
</li>
                            
<li >
    <a href="../../chapter_04/">Home</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapter 05 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../chapter_05/01_prokka/">01 prokka</a>
</li>
                            
<li >
    <a href="../../chapter_05/02_rast/">02 rast</a>
</li>
                            
<li >
    <a href="../../chapter_05/03_PGAAP/">03 PGAAP</a>
</li>
                            
<li >
    <a href="../../chapter_05/">Home</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../03_linux-administration/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../05_bioawk/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#awk-ngs">用 awk 处理 NGS 数据</a></li>
            <li><a href="#1-awk">1. 了解 awk 基本用法</a></li>
            <li><a href="#2-awk">2. awk 基本语法</a></li>
            <li><a href="#3">3. 示例</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="awk-ngs">用 awk 处理 NGS 数据</h1>
<p>awk 工具常用来对文件内容按行进行匹配搜索，一旦某一行中的内容与搜索条件匹配，则对该内容做进一步操作。本质上讲，awk 属于数据驱动的程序，因此 awk 程序也非常容易编写与阅读。高通量测序技术带来大量的数据，而生物学分析往往直需要其中特定的部分，这时 awk 就可以大显身手为测序数据的转换与分析提供帮助。我们首先来看一个最简单的 awk 命令程序：</p>
<pre><code class="bash"># 将contigs.fasta文件中序列ID打印到终端
# contigs.fasta内如：
# &gt;seq1
# ATGGGGTCCGATTACCG
# &gt;seq2
# CGGNTTACCGYGACAGT

$ awk '/&gt;/' contigs.fasta

# 屏幕上会输出：
&gt;seq1
&gt;seq2

$ awk '/^ATG/' contigs.fasta内如

#屏幕上会输出：
ATGGGGTCCGATTACCG
</code></pre>

<p>这个命令很简单，就是将 fasta 文件中包含 '&gt;' 字符的行输出，实际上就是将所有的序列头内容输出。作用类似<code>grep "&gt;"</code>。</p>
<p>awk 程序主体主要包括 pattern，action和input file：</p>
<ul>
<li>pattern 表示所要搜索的内容，可以用正则表达式。</li>
<li>{ action } 则表示搜索匹配后要做的操作。</li>
<li>input file：所要搜索的输入内容，比如前面例子的 contigs.fasta</li>
</ul>
<p>awk可以在shell里直接运行：</p>
<pre><code class="bash">$ awk 'pattern { action }' input_file
</code></pre>

<p>也可以写成awk程序来运行。一个 awk 程序往往如下所示：</p>
<pre><code class="awk">#!/usr/bin/awk -f
pattern { action }
</code></pre>

<p>awk 可以不需要输入文件；对于pattern和action来说，2者至少要有一个才能运行。如果没有pattern，则默认匹配任何输入，按行输出并执行action。如果没有action，则匹配pattern并按行输出不做额外操作。</p>
<pre><code class="bash"># 尝试以下语句，在终端打印`hello world`。这里BEGIN是pattern，{ print &quot;hello world&quot; } 是action
$ awk 'BEGIN { print &quot;hello world&quot; }'

# 模拟cat输出终端输入的字符。这里省略了pattern
$ awk '{ print }'
</code></pre>

<p>上面这个例子可以保存成文件（如<code>hello_world</code>）来运行，文件内容如下：</p>
<pre><code class="awk">#!/usr/bin/awk -f
# 注意不同发行版的linux，awk路径有所区别

BEGIN { print &quot;hello world&quot; }
</code></pre>

<p>运行这个程序：</p>
<pre><code class="bash">$ chmod +x hello_world
$ ./hello_world
</code></pre>

<h2 id="1-awk">1. 了解 awk 基本用法</h2>
<pre><code class="bash">$ awk '$1~/gene1/ { print $2 }' input_data
</code></pre>

<p>作用与 cat + grep + sed 类似</p>
<pre><code class="bash">$ cat input_data | grep gene1 | sed {$1}
</code></pre>

<h2 id="2-awk">2. awk 基本语法</h2>
<h3 id="21-pattern">2.1 Pattern</h3>
<h4 id="211">2.1.1 正则表达式</h4>
<p>pattern 可以采用正则表达式来匹配内容。用<code>/ regular expression /</code>来表示。</p>
<p>几个特殊的Patterns：</p>
<ul>
<li>BEGIN:</li>
<li>END:</li>
<li>BEGINFILE:</li>
<li>ENDFILE:</li>
</ul>
<h4 id="212">2.1.2 语句表达</h4>
<pre><code class="bash">$ awk '$1 == &quot;gene&quot; { print $2 }' genes.list
</code></pre>

<h3 id="22-action">2.2 Action</h3>
<h4 id="221-ifelse">2.2.1 if...else</h4>
<pre><code class="bash"># if block
$ awk '{if(condition) print $1}' input

# if else block
$ awk '{if(condition)
&gt;     print $1
&gt; else
&gt;     print $2
&gt; }' input
</code></pre>

<h4 id="222-while">2.2.2 while</h4>
<p>while 控制语句要换行，用4个空格划分控制块。</p>
<pre><code class="bash">$ awk '{ i = 1
&gt;     while (i &lt;= 3) {
&gt;         print $i
&gt;         i++
&gt;     }
&gt; }' input
</code></pre>

<h3 id="23">2.3. 内建变量</h3>
<h4 id="231-awk">2.3.1 控制 awk 的变量</h4>
<ul>
<li>BINMODE #</li>
<li>CONVFMT</li>
<li>FIELDWIDTHS #</li>
<li>FPAT #</li>
<li>FS</li>
<li>IGNORECASE #</li>
<li>LINT #</li>
<li>OFMT</li>
<li>OFS</li>
<li>ORS</li>
<li>PREC #</li>
<li>ROUNDMODE #</li>
<li>RS</li>
<li>SUBSEP</li>
<li>TEXTDOMAIN #</li>
</ul>
<h3 id="232">2.3.2 传递信息的变量</h3>
<ul>
<li>ARGC , ARGV</li>
<li>ARGIND #</li>
<li>ENVIRON</li>
<li>ERRNO #</li>
<li>FILENAME</li>
<li>FNR</li>
<li>NF</li>
<li>FUNCTAB #</li>
<li>NR</li>
<li>PROCINFO #</li>
<li>RLENGTH</li>
<li>RSTART</li>
<li>RT #</li>
<li>SYMTAB #</li>
</ul>
<h3 id="24">2.4. 内建函数</h3>
<h4 id="241">2.4.1 数学函数</h4>
<ul>
<li>atan2(y, x)</li>
<li>cos(x)</li>
<li>exp(x)</li>
<li>int(x)</li>
<li>log(x)</li>
<li>rand()</li>
<li>sin(x)</li>
<li>sqrt(x)</li>
<li>srand([ x ])</li>
</ul>
<h4 id="242">2.4.2 字符串函数</h4>
<ul>
<li>asort(source [ , dest [ , how ] ] ) #</li>
<li>asorti(source [ , dest [ , how ] ] ) #</li>
<li>gensub(regexp, replacement, how [ , target ] ) #</li>
<li>gsub(regexp, replacement [ , target ] )</li>
<li>index(in, find)</li>
<li>length( [ string ] )</li>
<li>match(string, regexp [ , array ] )</li>
<li>patsplit(string, array [ , fieldpat [ , seps ] ] ) #</li>
<li>split(string, array [ , fieldsep [ , seps ] ] )</li>
<li>sprintf(format, expression1, ...)</li>
<li>strtonum(str) #</li>
<li>sub(regexp, replacement [ , target ] )</li>
<li>substr(string, start [ , length ] )</li>
<li>tolower(string)</li>
<li>toupper(string)</li>
</ul>
<h4 id="243">2.4.3 输入输出函数</h4>
<ul>
<li>close(filename [ , how ] )</li>
<li>fflush( [ filename ] )</li>
<li>system(command)</li>
</ul>
<h4 id="244">2.4.4 时间函数</h4>
<ul>
<li>mktime(datespec)</li>
<li>strftime( [ format [ , timestamp [ , utc-flag ] ] ] )</li>
<li>systime()</li>
</ul>
<h4 id="245-bit">2.4.5 Bit操作函数</h4>
<ul>
<li>and(v1, v2 [, ...])</li>
<li>compl(val)</li>
<li>lshift(val, count)</li>
<li>or(v1, v2 [, ...])</li>
<li>rshift(val, count)</li>
<li>xor(v1, v2 [, ...])</li>
</ul>
<h4 id="246">2.4.6 其他</h4>
<ul>
<li>isarray(x)</li>
<li>bindtextdomain(directory [ , domain ] )</li>
<li>dcgettext(string [ , domain [ , category ] ] )</li>
<li>dcngettext(string1, string2, number [ , domain [ , category ] ] )</li>
</ul>
<h2 id="3">3. 示例</h2>
<p>示例部分介绍 awk 在日常中，特别是处理 ngs 数据时的一些例子。</p>
<h3 id="31">3.1 对列的操作</h3>
<p><strong>调整列顺序</strong>：在有GUI的操作系统里，一般采用类似 excel, calc 之类的软件导入数据文件，然后剪切各列调整顺序。如果用 awk 来解决也很方便，你只需要考虑好调整的各列顺序即可，action 里的{ print ...}顺序就是重新调整后的各列顺序：</p>
<pre><code class="bash">$ awk '{ print $3, $5, $7, $2, $1, $4, $6 }' infile.txt &gt; outfile.txt
</code></pre>

<p><strong>插入列</strong>：有时候要插入一列数据，用awk可以很方便的实现：</p>
<pre><code class="bash">$ awk '{ print $1, $2 &quot;gene expression&quot;, $3}' infile.txt &gt; outfile.txt
</code></pre>

<h3 id="32">3.2 对行的操作</h3>
<p><strong>去除重复的行</strong>：有时候数据里含有重复的行，而当你只需要唯一性数据时，就可以用这行程序，只保留具有唯一性的数据行。</p>
<pre><code class="bash">$ awk '!x[$0]++' infile.txt &gt; outfile.txt
</code></pre>

<h3 id="33">3.3 格式化输出</h3>
<pre><code class="bash">$ awk -F&quot;:&quot; 'BEGIN { printf &quot;%-8s %-3s&quot;, &quot;User&quot;, &quot;UID&quot; } \
&gt; NR==1,NR==20 { printf &quot;%-8s %-3d&quot;, $1, $3 }' /etc/passwd
</code></pre>

<h3 id="34">3.4 合并文件</h3>
<pre><code class="bash"># 搜索当前目录下所有包含序列ATCCGGA的fasta文件，并输出文件名和行号以及序列
$ find . -type f -name &quot;*.fasta&quot; -exec awk '/ATCCCGGA/ {print FILENAME, NR, $0}' {} \+
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
